---
layout: post
status: publish
published: true
title: RESTful Rails for Ajax
author:
  display_name: Geoff Lane
  login: admin
  email: geoff@zorched.net
  url: http://www.zorched.net
author_login: admin
author_email: geoff@zorched.net
author_url: http://www.zorched.net
wordpress_id: 78
wordpress_url: http://www.zorched.net/2007/04/27/restful-rails-for-ajax/
date: '2007-04-27 21:53:27 -0400'
date_gmt: '2007-04-28 03:53:27 -0400'
categories:
- Code
- Web
- Ruby
tags:
- DOJO-Toolkit
- JSON
- ajax
comments:
- id: 10873
  author: Robert Berger
  author_email: rberger@ibd.com
  author_url: ''
  date: '2007-08-02 23:35:44 -0400'
  date_gmt: '2007-08-03 05:35:44 -0400'
  content: "So how would I do the other direction. I want to do an update from the
    client to the Rails server.  Ie. and \"update\". \r\n\r\nThanks!"
- id: 14465
  author: Geoff Lane
  author_email: geoff@zorched.net
  author_url: http://www.zorched.net
  date: '2009-01-11 20:24:28 -0500'
  date_gmt: '2009-01-12 02:24:28 -0500'
  content: "Robert,\r\nOk so a bit late (like more than year)...but I did show some
    examples of doing updates in another post. Basically you just have to do a PUT
    and send the proper XML data. See <a href=\"http:&#47;&#47;www.zorched.net&#47;2007&#47;08&#47;10&#47;interact-with-rest-services-from-the-command-line&#47;\"
    rel=\"nofollow\">Interact With REST Services from the Command Line<&#47;a>."
---
<p>Ruby on Rails 1.2 added full support for building RESTful services to the already nice web page support. REST is a conceptually simple idea, yet incredibly powerful. REST is a Web based API to an application. It builds on the basic building blocks of HTTP: URLs and HTTP Methods (think verbs).</p>
<p>A URL (Uniform Resource Locator) uniquely identifies a resources on the web. HTTP uses the concept of Methods to give context to a request to a URL. Most developers will be familiar with a GET and a POST. These methods are used to get a resource and to modify a resource respectively. But there are <a href="http:&#47;&#47;www.w3.org&#47;Protocols&#47;rfc2616&#47;rfc2616-sec9.html">other http verbs<&#47;a> as well. The two other interesting ones for a REST service are PUT and DELETE. Both of these are pretty self explanatory. PUT creates a resource at the remote location and DELETE removes one.</p>
<p>For Example:<br />
GET<br />
http:&#47;&#47;example.com&#47;catalog&#47;item&#47;1</p>
<p>DELETE<br />
http:&#47;&#47;example.com&#47;catalog&#47;item&#47;1</p>
<p>Both of these use the same URL, but the HTTP Method means different things will happen.</p>
<h3>Creating A RESTful API with Rails<&#47;h3><br />
Rails makes it easy to create a RESTful application. The same controllers can be used to render a web page and to provide a programmatic API to your application.</p>
<p>Rails provides a <em>scaffold_resource<&#47;em> generator that creates the skeleton of a resource driven application:<br />
<code><br />
.&#47;script&#47;generate scaffold_resource order<br />
<&#47;code></p>
<p>This creates Model, View and Controllers just like regular scaffold, but unlike scaffold, it adds some extra functionality.<br />
<code lang="ruby"><br />
class OrdersController < ApplicationController<br />
  # GET &#47;orders&#47;1<br />
  # GET &#47;orders&#47;1.xml<br />
  def show<br />
    @order = Order.find(params[:id])</p>
<p>    respond_to do |format|<br />
      format.html # show.rhtml<br />
      format.xml  { render :xml => @order.to_xml }<br />
    end<br />
  end<br />
end<br />
<&#47;code></p>
<p>Now if you request a path ending in <em>.xml<&#47;em> it will render the response as an XML document that can be consumed by another program.</p>
<h3>Applying REST as an Ajax solution<&#47;h3><br />
The great news is that you can use this RESTful API directly as an API to use for building a highly-dynamic Ajax application. (See my post on <a href="http:&#47;&#47;www.zorched.net&#47;2006&#47;10&#47;30&#47;ajax-with-json-using-php-and-dojo&#47;">using Ajax with PHP<&#47;a> for an example). But what's even cooler is that you can use the same technique to build a <a href="http:&#47;&#47;www.json.org&#47;">JSON<&#47;a> API. JSON is much easier and less resource intensive to consume in an Ajax application than XML.</p>
<p>Changing your controller to support JSON ends up being really easy. All you have to do is add a single line in the respond_to block to support it:<br />
<code lang="ruby"><br />
class OrdersController < ApplicationController<br />
  # GET &#47;orders&#47;1<br />
  # GET &#47;orders&#47;1.xml<br />
  # GET &#47;orders&#47;1.js<br />
  def show<br />
    @order = Order.find(params[:id])</p>
<p>    respond_to do |format|<br />
      format.html # show.rhtml<br />
      format.xml  { render :xml => @order.to_xml }<br />
      format.js { render :json => @order.to_json }<br />
    end<br />
  end<br />
end<br />
<&#47;code></p>
<p>Just like in the XML example, if you make a request that ends in <em>.js<&#47;em> then you will get a response rendered as JSON. Consuming that JSON Service with something like Dojo allows you to easily create a dynamic web application.</p>
<p><code lang="javascript"><br />
dojo.require("dojo.event.*");<br />
dojo.require("dojo.io.*");<br />
dojo.require("dojo.date.*");<br />
dojo.require("dojo.lfx.*");</p>
<p>function getOrder(id) {<br />
    dojo.io.bind({url: "&#47;orders&#47;" + id + ".js", handler: showOrder, mimetype: "text&#47;json"});<br />
}</p>
<p>function showOrder(type, data, evt) {<br />
    dojo.dom.removeChildren(dojo.byId('order'));<br />
    appendOrderPart('order_number', data.attributes.order_number);<br />
    appendOrderPart('time', data.attributes.time);<br />
    dojo.lfx.highlight(dojo.byId('order'), dojo.lfx.Color);<br />
}<br />
function appendOrderPart(id, value) {<br />
    var element = document.createElement("div");<br />
    element.id=id;<br />
    element.innerHTML=value;<br />
    dojo.byId('order').appendChild(element);<br />
}<br />
function init() {<br />
	getOrder(1);<br />
}</p>
<p>dojo.addOnLoad(init);<br />
<&#47;code></p>
<h3>Conclusion<&#47;h3><br />
With a few simple lines of code you can not only render a web page, you can also create an XML API and a JSON API. That's what I call developer friendly!</p>
