---
layout: post
status: publish
published: true
title: Custom WebDAV Server Using .NET
author:
  display_name: Geoff Lane
  login: admin
  email: geoff@zorched.net
  url: http://www.zorched.net
author_login: admin
author_email: geoff@zorched.net
author_url: http://www.zorched.net


date: '2006-02-02 21:43:01 -0500'
date_gmt: '2006-02-03 03:43:01 -0500'
categories:
- Code
- ".NET"
- WebDAV
tags:
- WebDAV
---
<p>As I discussed in a <a href="http://www.zorched.net/2006/01/20/aspnet-web-application-without-aspx-extension/">previous post "ASP.NET Web Application without ASPX Extension"</a>, I've been working on a custom <a href="http://www.webdav.org">WebDAV</a> server for a client. The initial proof-of-concept was just to see if we could get some .NET code that would respond to all paths for a given web application. From there I had to make WebDAV work.</p>
<h3>What is WebDAV</h3>
To recap: <a href="http://www.webdav.org">WebDAV</a> is an <abbr name="Internet Engineering Task Force">IETF</abbr> Standard Protocol. It is an extension to the ubiquitous HTTP standard, adding on request methods to get property information about files and folders, make folders (called collections in WebDAV parlance), change properties, lock files, etc. Basically anything that you would want on a distributed file system. WebDAV is natively supported by Windows 2000 and XP, Mac OS X, and Linux (using <a href="http://dav.sourceforge.net/">davfs</a>). When using this native support, you're able to interact with WebDAV just like you are using a local filesystem or a network share. There are also many standalone client implementations that act more like FTP clients.</p>
<h3>Why Would You Write Your Own DAV Server?</h3>
Sharing files over a network is nothing new of course. Using Windows File Sharing, many people are used to using network shares to store files on a server and to share with their coworkers. The limitation of most of these file sharing systems is that they share exactly what is on the filesystem. What if you want to integrate file sharing with an application that stores file meta-data in a database? What if you want to programmatically control the files and folders that you show to your users? By building your own WebDAV server you can query a database to get all of the meta-data (and even file contents) to serve to your users.</p>
<h3>How To Build a WebDAV Server</h3>
I did quite a bit of searching and found WebDAV server implementation in <a href="http://www.comlounge.net/webdav/">Python</a>, <a href="http://redhanded.hobix.com/inspect/webrickWebdavHandlerSafelyExtractedFromTheWild.html">Ruby</a>, and <a href="http://jakarta.apache.org/slide/index.html">Java</a>, but could not find anything done in a .NET language which my client uses for all of their application infrastructure. So, I built one!</p>
<p>As I mentioned in my <a href="http://www.zorched.net/2006/01/20/aspnet-web-application-without-aspx-extension/">previous post</a>, we can take over the complete HTTP request for all requested paths. I use a <a href="http://www.dofactory.com/Patterns/PatternCommand.aspx">Command Pattern</a> to handle the different types of WebDAV requests. The Commands are responsible for getting information from the HTTP Request that they need to fulfill the request and for writing the proper HTTP Response. Each of the Commands delegates the actual File manipulation to a set of provider classes. Those classes are accessed through an <a href="http://www.dofactory.com/Patterns/PatternAbstract.aspx">Abstract Factory</a> which allows for me to easily change the backend implementation. This allows for a good separation of concerns. The WebDAV Service layer knows how to read and write WebDAV and the File Provider layer knows how to get and store information about files and folders. <em>(The abstraction between the Commands and the File Providers is a bit leaky still, but I'm confident I'll be able to refactor it into a cleaner separation.)</em></p>
<p>The first backend provider that I created for testing was a FileSystem provider. I've mapped the WebDAV server to a specific directory and use standard <code>System.IO</code> commands to manipulate files. This is a lot easier because it allowed me to focus on implementing the protocol without worrying about interacting with a less familiar data access layer.</p>
<h3>Test Your Implementation</h3>
The WebDAV folks have built a great test suite called <a href="http://www.webdav.org/neon/litmus/">Litmus</a> that you can use to validate your server implementation. It performs all of the basic operations on files and collections to validate that the server performs to the specification. Start with Litmus and you've got your entire functional test harness written for you. That is some <abbr name="Test Driven Development">TDD</abbr> in action!
Litmus goes a long way to get you to protocol compliance, but it took a bit of cleaning and tweaking before Windows Explorer would happily mount the Web Folder.</p>
<p>In addition to Litmus I found a couple of other tools really handy for debugging:</p>
<ul>
<li><a href="http://www.ethereal.com/">Ethereal</a> - a very nice protocol analyzer that will let you inspect a series of requests and responses.</li>
<li><a href="http://www.ics.uci.edu/%7Ewebdav/">DAVExplorer</a> - a Java WebDAV client that will write detailed logs of requests and responses.</li>
</ul></p>
<p>Don't be afraid to write your own WebDAV server, it's really fun!</p>
<h3>References</h3></p>
<p>WebDAV Reference Book:
<a href="http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FWebDAV-Next-Generation-Collaborative-Web-Authoring%2Fdp%2F0130652083%3Fie%3DUTF8%26s%3Dbooks%26qid%3D1178055436%26sr%3D8-1&tag=zorchednet-20&linkCode=ur2&camp=1789&creative=9325">WebDAV: Next-Generation Collaborative Web Authoring</a><img src="http://www.assoc-amazon.com/e/ir?t=zorchednet-20&amp;l=ur2&amp;o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> by Lisa Dusseault</p>
