<p>I've written about <a href="http://www.zorched.net/category/code/unit-testing/">Unit Testing</a> and <a href="http://www.zorched.net/category/code/automation/">Build Automation</a> in the past, but mostly dealing with Java projects and tools (because I usually write about things I'm working on at the time). Well, I've started a .NET project for the first time in a while so I want to solve some of the samde problems in this environment.</p>
<h2>Why MSBuild?</h2>
In the Java world, the natural choice for automation is usually <a href="http://ant.apache.org">Ant</a>. <a href="http://nant.sourceforge.net/">NAnt</a> was created for the as a work alike for the .NET platform and is a very good tool. I've build custom extensions for <a href="http://www.zorched.net/nant-sqlschematask/">database automation</a> in the past and used it successfully. So why would I consider MSBuild? With the advent of <a href="http://msdn2.microsoft.com/en-us/vstudio/default.aspx">Visual Studio 2005</a>, Microsoft included MSBuild as the build tool for its projects. All of the project files generated by Visual Studio are MSBuild files in disguise. This makes it really easy to leverage the project files to chain together a nice automated build.</p>
<h2>Why NUnit?</h2>
Microsoft is a true believer in <a href="http://en.wikipedia.org/wiki/Not_Invented_Here">Not Invented Here</a> and as such they created their own Unit Testing framework that looks and acts exactly the same as <a href="http://nunit.org">NUnit</a>. The MS XUnit framework only comes with the higher-end Team System versions of Visual Studio. In addition it is very hard to deploy the DLLs to build systems. The only way to get the proper DLLs installed is to install the full Visual Studio. That seems like a really big problem to me. With NUnit you can include the needed DLLs in your version control system and reference them in the project which makes it very easy to build and test code and use a Continuous Integration process.</p>
<h2>How to Integrate MSBuild and NUnit</h2>
Here's the good news, all of the work has been done for you. The good people at <a href="http://www.tigris.org">Tigris.org</a> (the creators of <a href="http://subversion.tigris.org">Subversion</a>) have created a series of <a href="http://msbuildtasks.tigris.org">MSBuild Tasks</a> filling in the gaps that MSBuild was missing. One of the included Tasks is an NUnit task. Their hard work and the simple script below should get ou started with a build that can run your tests as well.</p>
<h2>Example Build File</h2>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;Project</span> <span class="na">DefaultTargets=</span><span class="s">"Build"</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/developer/msbuild/2003"</span><span class="nt">&gt;</span>
     <span class="c">&lt;!-- Import the MSBuild Tasks --&gt;</span>
	<span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;PropertyGroup&gt;</span>
		<span class="nt">&lt;Configuration</span> <span class="na">Condition=</span><span class="s">" '$(Configuration)' == '' "</span><span class="nt">&gt;</span>Debug<span class="nt">&lt;/Configuration&gt;</span>
		<span class="nt">&lt;ClassLibraryOutputDirectory&gt;</span>bin\$(Configuration)<span class="nt">&lt;/ClassLibraryOutputDirectory&gt;</span>
		<span class="nt">&lt;ProjectDir&gt;</span>ProjectName<span class="nt">&lt;/ProjectDir &gt;</span>
		<span class="nt">&lt;ProjectTestDir&gt;</span>ProjectNameTest<span class="nt">&lt;/ProjectTestDir &gt;</span>
		<span class="nt">&lt;ProjectFile&gt;</span>$(ProjectDir)\ProjectName.csproj<span class="nt">&lt;/ProjectFile &gt;</span>
		<span class="nt">&lt;TestProjectFile&gt;</span>$(ProjectTestDir)\ProjectNameTest.csproj<span class="nt">&lt;/TestProjectFile &gt;</span>
	<span class="nt">&lt;/PropertyGroup&gt;&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>	<span class="c">&lt;!-- Build projects by calling the Project files generated by VS --&gt;</span>
	<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;MSBuild</span> <span class="na">Projects=</span><span class="s">"$(ProjectFile)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;MSBuild</span> <span class="na">Projects=</span><span class="s">"$(TestProjectFile)"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/Target&gt;&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>	<span class="c">&lt;!-- Run Unit tests --&gt;</span>
	<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"Test"</span> <span class="na">DependsOnTargets=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;CreateItem</span> <span class="na">Include=</span><span class="s">"$(ProjectTestDir)\$(ClassLibraryOutputDirectory)\*.Tests.dll"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;Output</span> <span class="na">TaskParameter=</span><span class="s">"Include"</span> <span class="na">ItemName=</span><span class="s">"TestAssembly"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/CreateItem&gt;</span>
		<span class="nt">&lt;NUnit</span> <span class="na">Assemblies=</span><span class="s">"@(TestAssembly)"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/Target&gt;</span>
<span class="nt">&lt;/Project&gt;&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span></code></pre></figure></p>
<p>The "Test" target above uses the NUnit task to run all of the NUnit Tests found in the DLL. There are a number of different ways to create ItemGroups ins MSBuild, all of which are odd and confusing. If anyone has any ideas on what the best practices in this regard, let me know.</p>
<p>One final plug for my favorite Visual Studio plugin, <a href="http://www.jetbrains.com/resharper/">ReSharper</a>. It includes support for NUnit. It will help you create NUnit Tests and then lets you run them and debug them from within your IDE. It's almost like you have a real IDE all of a sudden!</p>
<h2>References</h2>
<a href="http://nunit.org">NUnit</a>
<a href="http://msbuildtasks.tigris.org">MSBuild Tasks</a>
<a href="http://dougrohm.com/cs/articles/56.aspx">Integrating MSBuild with CruiseControl.NET</a></p>
<p><a href="http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FPragmatic-Unit-Testing-NUnit-Programmers%2Fdp%2F0974514020%2Fsr%3D8-1%2Fqid%3D1164768532%3Fie%3DUTF8%26s%3Dbooks&tag=zorchednet-20&linkCode=ur2&camp=1789&creative=9325">Pragmatic Unit Testing in C# with NUnit</a><img src="http://www.assoc-amazon.com/e/ir?t=zorchednet-20&amp;l=ur2&amp;o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FNUnit-Pocket-Reference-OReilly%2Fdp%2F0596007396%2Fsr%3D8-4%2Fqid%3D1164768532%3Fie%3DUTF8%26s%3Dbooks&tag=zorchednet-20&linkCode=ur2&camp=1789&creative=9325">NUnit Pocket Reference</a><img src="http://www.assoc-amazon.com/e/ir?t=zorchednet-20&amp;l=ur2&amp;o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FDeploying-NET-Applications-Learning-ClickOnce%2Fdp%2F1590596528%2Fsr%3D8-1%2Fqid%3D1164768649%3Fie%3DUTF8%26s%3Dbooks&tag=zorchednet-20&linkCode=ur2&camp=1789&creative=9325">Deploying .NET Applications: Learning MSBuild and ClickOnce</a><img src="http://www.assoc-amazon.com/e/ir?t=zorchednet-20&amp;l=ur2&amp;o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>
