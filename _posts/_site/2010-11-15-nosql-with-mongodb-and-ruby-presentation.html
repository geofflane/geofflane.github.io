<p>I presented at the Milwaukee Ruby User's Group tonight on NoSQL using MongoDB and Ruby.</p>
<h3>Code Snippets for the Presentation</h3></p>
<h4>Basic Operations</h4>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// insert data</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Miller"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Lakefront"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Point"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Steven's Point"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Pabst"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Blatz"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Coors"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Golden Springs"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"CO"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="c1">// simple queries</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">findOne</span><span class="p">()</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="s2">"metro.city"</span> <span class="p">:</span> <span class="s2">"Milwaukee"</span> <span class="p">}</span> <span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="s2">"metro.state"</span><span class="p">:</span> <span class="p">{</span><span class="na">$in</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"WI"</span><span class="p">,</span> <span class="s2">"CO"</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="c1">// update data</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Lakefront"</span><span class="p">},</span> <span class="p">{</span> <span class="na">$set</span> <span class="p">:</span> <span class="p">{</span> <span class="na">thebest</span> <span class="p">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="c1">// delete data</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">remove</span><span class="p">({</span><span class="na">name</span><span class="p">:</span><span class="s2">"Coors"</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span></code></pre></figure></p>
<h4>Ruby Example</h4>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'mongo'</span>
<span class="kp">include</span> <span class="no">Mongo</span>
<span class="n">db</span>   <span class="o">=</span> <span class="no">Connection</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">db</span><span class="p">(</span><span class="s1">'sample-db'</span><span class="p">)</span>
<span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="s1">'factories'</span><span class="p">)</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">remove</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Miller"</span><span class="p">,</span>    <span class="ss">:metro</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:city</span> <span class="o">=&gt;</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Lakefront"</span><span class="p">,</span> <span class="ss">:metro</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Point"</span><span class="p">,</span>     <span class="ss">:metro</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:city</span> <span class="o">=&gt;</span> <span class="s2">"Steven's Point"</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Pabst"</span><span class="p">,</span>     <span class="ss">:metro</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:city</span> <span class="o">=&gt;</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Blatz"</span><span class="p">,</span>     <span class="ss">:metro</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:city</span> <span class="o">=&gt;</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Coors"</span><span class="p">,</span>     <span class="ss">:metro</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:city</span> <span class="o">=&gt;</span> <span class="s2">"Golden Springs"</span><span class="p">,</span> <span class="ss">:state</span> <span class="o">=&gt;</span> <span class="s2">"CO"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
<span class="nb">puts</span> <span class="s2">"There are </span><span class="si">#{</span><span class="n">coll</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> factories. Here they are:"</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">find</span><span class="p">().</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">doc</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">doc</span><span class="p">.</span><span class="nf">inspect</span> <span class="p">}</span>
<span class="n">coll</span><span class="p">.</span><span class="nf">map_reduce</span><span class="p">(</span><span class="s2">"function () { emit(this.metro.city, this.name); }"</span><span class="p">,</span> <span class="s2">"function (k, vals) { return vals.join("</span><span class="p">,</span><span class="s2">"); }"</span><span class="p">).</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">r</span><span class="p">.</span><span class="nf">inspect</span> <span class="p">}</span></code></pre></figure></p>
<h4>Map Reduce Example</h4>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Miller"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Lakefront"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Point"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Steven's Point"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Pabst"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Blatz"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Milwaukee"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"WI"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"Coors"</span><span class="p">,</span> <span class="na">metro</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="s2">"Golden Springs"</span><span class="p">,</span> <span class="na">state</span><span class="p">:</span> <span class="s2">"CO"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
<span class="kd">var</span> <span class="nx">fmap</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">metro</span><span class="p">.</span><span class="nx">city</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">fred</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">vals</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">vals</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">","</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">res</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">factories</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span><span class="nx">fmap</span><span class="p">,</span> <span class="nx">fred</span><span class="p">)</span>
<span class="nx">db</span><span class="p">[</span><span class="nx">res</span><span class="p">.</span><span class="nx">result</span><span class="p">].</span><span class="nx">find</span><span class="p">()</span>
<span class="nx">db</span><span class="p">[</span><span class="nx">res</span><span class="p">.</span><span class="nx">result</span><span class="p">].</span><span class="nx">drop</span><span class="p">()</span></code></pre></figure></p>
<h3>The Presentation</h3>
<a href="/wp-content/uploads/2010/11/NoSQL-with-MongoDB-and-Ruby.pdf">Download NoSQL with MongoDB and Ruby Slides</a></p>
<p>Thanks to Meghan at <a href="http://www.10gen.com">10Gen</a> for sending stickers and a copy of <a href="http://www.amazon.com/gp/product/1449381561?ie=UTF8&tag=zorchednet-20&linkCode=as2&camp=1789&creative=390957&creativeASIN=1449381561">MongoDB: The Definitive Guide</a><img src="http://www.assoc-amazon.com/e/ir?t=zorchednet-20&l=as2&o=1&a=1449381561" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> that I gave out as a door prize. I read the book quickly this weekend before the talk and found it quite good, so I recommend it if you want to get started with MongoDB.</p>
