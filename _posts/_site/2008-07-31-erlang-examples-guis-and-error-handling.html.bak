<p>This is part of a series on the <a href="http://www.erlang.org/course/exercises.html">Erlang Exercises</a> which is a great set of programming problems that challenge you to implement solutions to some common Erlang problems. I'm going to share some of my solutions to these problems.</p>
<h2>Robustness in Erlang, and use of a graphics package</h2>
<strong>Excercise:</strong> Create a window containing three buttons: Quit , Spawn , Error.
The <strong>Spawn</strong> button shall create a child process which displays an identical window.
The <strong>Quit</strong> button should kill the window and its child windows.
The <strong>Error</strong> button should cause a runtime error that kills the window (and its children), this window shall then be restarted by its parent.</p>
<p><figure class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">gui</span><span class="p">).</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">init</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nf">init</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nv">S</span> <span class="o">=</span> <span class="nn">gs</span><span class="p">:</span><span class="nf">start</span><span class="p">(),</span>
    <span class="nv">Win</span> <span class="o">=</span> <span class="nn">gs</span><span class="p">:</span><span class="nf">create</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="p">[{</span><span class="n">width</span><span class="p">,</span> <span class="mi">350</span><span class="p">},</span> <span class="p">{</span><span class="n">height</span><span class="p">,</span> <span class="mi">100</span><span class="p">}]),</span>
    <span class="nn">gs</span><span class="p">:</span><span class="nf">create</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">quit</span><span class="p">,</span> <span class="nv">Win</span><span class="p">,</span> <span class="p">[{</span><span class="n">label</span><span class="p">,</span> <span class="p">{</span><span class="n">text</span><span class="p">,</span> <span class="s">"Quit"</span><span class="p">}},</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">}]),</span>
    <span class="nn">gs</span><span class="p">:</span><span class="nf">create</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="nb">spawn</span><span class="p">,</span> <span class="nv">Win</span><span class="p">,</span> <span class="p">[{</span><span class="n">label</span><span class="p">,</span> <span class="p">{</span><span class="n">text</span><span class="p">,</span> <span class="s">"Spawn"</span><span class="p">}},</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="mi">100</span><span class="p">}]),</span>
    <span class="nn">gs</span><span class="p">:</span><span class="nf">create</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nv">Win</span><span class="p">,</span> <span class="p">[{</span><span class="n">label</span><span class="p">,</span> <span class="p">{</span><span class="n">text</span><span class="p">,</span> <span class="s">"Error"</span><span class="p">}},</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="mi">200</span><span class="p">}]),</span>
    <span class="nn">gs</span><span class="p">:</span><span class="nf">config</span><span class="p">(</span><span class="nv">Win</span><span class="p">,</span> <span class="p">{</span><span class="n">map</span><span class="p">,</span> <span class="n">true</span><span class="p">}),</span>
    <span class="nf">loop</span><span class="p">().</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nf">loop</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">receive</span>
        <span class="p">{</span><span class="n">gs</span><span class="p">,</span> <span class="nb">spawn</span><span class="p">,</span> <span class="n">click</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
            <span class="nv">Pid</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="nf">handle_error</span><span class="p">(</span><span class="nf">self</span><span class="p">(),</span> <span class="nv">Pid</span><span class="p">),</span>
            <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">"got here</span><span class="si">~n</span><span class="s">"</span><span class="p">,[]),</span>
            <span class="nf">loop</span><span class="p">();</span>
        <span class="p">{</span><span class="n">gs</span><span class="p">,</span> <span class="n">quit</span><span class="p">,</span> <span class="n">click</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
            <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">"quitting</span><span class="si">~n</span><span class="s">"</span><span class="p">,[]),</span>
            <span class="nn">gs</span><span class="p">:</span><span class="nf">stop</span><span class="p">();</span>
        <span class="p">{</span><span class="n">gs</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">click</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_}</span> <span class="o">-&gt;</span>
            <span class="nn">erlang</span><span class="p">:</span><span class="nf">error</span><span class="p">(</span><span class="n">errorclick</span><span class="p">);</span>
        <span class="nb">exit</span> <span class="o">-&gt;</span>
            <span class="n">bye</span>
    <span class="k">end</span><span class="p">.</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nf">handle_error</span><span class="p">(</span><span class="nv">MasterPid</span><span class="p">,</span> <span class="nv">Pid</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span><span class="p">()</span> <span class="o">-&gt;</span>
                  <span class="nb">process_flag</span><span class="p">(</span><span class="n">trap_exit</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
                  <span class="nb">link</span><span class="p">(</span><span class="nv">Pid</span><span class="p">),</span>
                  <span class="k">receive</span>
                      <span class="p">{</span><span class="n">'EXIT'</span><span class="p">,</span> <span class="nv">Pid</span><span class="p">,</span> <span class="p">{</span><span class="n">errorclick</span><span class="p">,</span> <span class="p">_}}</span> <span class="o">-&gt;</span>
                          <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">" </span><span class="si">~p</span><span class="s"> died :</span><span class="si">~n</span><span class="s">"</span><span class="p">,[</span><span class="nv">Pid</span><span class="p">]),</span>
                          <span class="nv">MasterPid</span> <span class="o">!</span> <span class="p">{</span><span class="n">gs</span><span class="p">,</span> <span class="nb">spawn</span><span class="p">,</span> <span class="n">click</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">};</span>
                      <span class="p">_</span> <span class="o">-&gt;</span>
                          <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">" really quitting :</span><span class="si">~n</span><span class="s">"</span><span class="p">,</span> <span class="p">[]),</span>
                          <span class="nv">MasterPid</span> <span class="o">!</span> <span class="nb">exit</span>
                  <span class="k">end</span>
          <span class="k">end</span><span class="p">).</span></code></pre></figure></p>
<h4>gs</h4>
The <em>gs</em> code is all GUI code. It just goes to show that you can use FP to create GUIs even if it's not quite as intuitive as it might be in an OO language. It creates a windows with a series of buttons on it.</p>
<h4>handle_error</h4>
This <em>handle_error</em> code shows linking a Process to another error handler process. That spawns a process whose sole purpose is to listen for errors from the main process. If an <em>{'EXIT', Pid, {errorclick, _}}</em> error is received the error handler sends a message back asking the <em>MasterPid</em> to spawn a new window.</p>
